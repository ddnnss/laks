<div id="page-header">
  <div class="container clearfix">

    <nav class="breadcrumb float-md-left">
      <a class="breadcrumb-item" href="/">ГЛАВНАЯ</a>
      <a class="breadcrumb-item" href="/category/<%= @parent_cat.cat_name_translit%>"><%= @parent_cat.cat_name.mb_chars.upcase%></a>
      <span class="breadcrumb-item active"><%= @subcat.subcat_name.mb_chars.upcase%></span>
    </nav>
  </div>
</div>
<div id="content" class="py-3 py-lg-6">
  <div class="container">

      <!-- Products grid -->

        <div class="row">
          <div class="col-lg-12">

            <a href="/subcategory/<%=@subcat.subcat_name_translit%>?filter=all" class="mb-2 btn btn-outline-primary " id="filter-all">ВСЕ ТОВАРЫ</a>
            <a href="/subcategory/<%=@subcat.subcat_name_translit%>?filter=new" class="mb-2 btn btn-outline-success " id="filter-new">НОВИНКИ</a>
            <%@filters.each do |f| %>
                <a href="/subcategory/<%=@subcat.subcat_name_translit%>?filter=<%=f%>" class="mb-2 btn btn-outline-secondary " id="filter-<%=f%>"><%=f%></a>

            <%end%>
          </div>

          <div class="col-lg-12">
            <form class="form-inline  text-sm" method="get">
              <label class="control-label mr-2">Поиск:</label>
              <input id="searchtxt" type="text" class="form-control form-control-sm mr-lg-2" name="search" placeholder="часть названия товара">
              <label class="control-label mr-2">Сортировать:</label>
              <select class="form-control form-control-sm" id="sort_select" name="sort_type">
                <option value="1">Название A-Я</option>
                <option value="2">Название Я-А</option>
                <option value="3">Цена (больше)</option>
                <option value="4">Цена (меньше)</option>
                <option value="5">Скидка (больше)</option>
                <option value="6">Скидка (меньше)</option>
              </select>
              <label class="control-label mr-2 ml-lg-3">Показывать:</label>
              <select class="form-control form-control-sm" id="pp_select" name="pp">
                <option value="12">12</option>
                <option value="15">15</option>
                <option value="21">21</option>
                <option value="28">28</option>
                <option value="34">34</option>
                <option value="41">41</option>
              </select>
          <button style="margin-left: 20px;"  type="submit" class="mb-1 btn btn-primary">Применить</button>
            </form>
          </div>

        </div>
        <hr class="my-4" >


        <div class="row">
          <%@items.each do |item|%>
          <div class="col-lg-3">
            <!-- Product 2 -->
            <div class="card mb-4 product-card hover-shadow ">
              <%if item.item_new %>
                  <div class="card-ribbon card-ribbon-top card-ribbon-left bg-success text-white"> НОВИНКА </div>
              <%end%>
              <%if item.collection_id > 0 %>
                  <div class="card-ribbon card-ribbon-top card-ribbon-left bg-primary text-white" style="    left: -95px !important;
                      width: 300px;
                      top: 36px;"> В КОЛЛЕКЦИИ </div>
              <%end%>
              <!-- Hover content
              <div class="overlay-hover-content overlay-op-7">
                <a href="shop-cart.html" class="btn btn-primary btn-block text-uppercase font-weight-bold mb-3 btn-lg"><i class="fa fa-cart-plus mr-2"></i> В корзину</a>
                <a href="shop-product.html" class="text-white text-sm">Подробнее о товаре</a> <a href="#" class="text-white text-sm">Добавить в закладки</a>

              </div>-->
              <!-- Image & price content -->
              <div class="pos-relative">
                <a href="/product/<%=item.item_name_translit%>">
                <img class="card-img-top img-fluid" src="/images/items/<%=item.id%>/<%=item.item_image1%>" alt="Купить <%=item.item_name%> в Москве по оптовым ценам">
                </a>
                <%if item.item_discount > 0 %>
                    <span class="badge badge-primary product-price-badge pos-absolute pos-t pos-r mt-2 mr-2 persist">
                 - <%=item.item_discount%> %
                </span>
                <%else %>

                <%end%>

              </div>
              <!-- Content -->
              <div class="card-body text-center ">
                <div style="height: 60px; padding-bottom: 10px;">
                <a style="text-decoration: none; color: #3A4A59; font-weight: bold;" href="/product/<%=item.item_name_translit%>"> <%=item.item_name%></a>
              </div>
                <hr/>
                <small class="text-muted text-uppercase"><span style="color: #3A4A59;"> Артикул :<span class="text-muted"> <%= item.item_article%></span></span></small>
                <hr/>
                <div id="spinner_<%=item.id%>" ></div>
                <div id="cart_buttons_<%=item.id%>">
                  <%if item.item_presents%>
                      <%if session[:cart].nil?%>
                          <a style="color: #3A4A59;" href="/addtocart/<%=item.id%>" id="item-<%=item.id%>" onclick="return theFunction(<%=item.id%>);" data-remote="true"><span id="cart_state_<%=item.id%>" class="fa fa-cart-plus"></span><span id="cart_state_txt_<%=item.id%>" style="font-size: 13px;"> ДОБАВИТЬ</span></a>

                      <%else%>
                          <%if session[:cart].keys.include? item.id.to_s%>

                              <a style="color: #3A4A59;" href="/addtocart/<%=item.id%>" id="item-<%=item.id%>" onclick="return theFunction(<%=item.id%>);" data-remote="true"><span id="cart_state_<%=item.id%>" class="fas fa-cart-arrow-down"></span><span id="cart_state_txt_<%=item.id%>" style="font-size: 13px;"> ДОБАВИТЬ ЕЩЕ</span></a>

                          <%else%>
                              <a style="color: #3A4A59;" href="/addtocart/<%=item.id%>" id="item-<%=item.id%>" onclick="return theFunction(<%=item.id%>);" data-remote="true"><span id="cart_state_<%=item.id%>" class="fa fa-cart-plus"></span><span id="cart_state_txt_<%=item.id%>" style="font-size: 13px;"> ДОБАВИТЬ</span></a>
                          <%end%>
                      <%end%>
                  <%else%>
                      <a href="javascript:void(0)" ><span class="fas fa-lock"></span><span style="font-size: 13px;"> НЕТ В НАЛИЧИИ</span></a>
                  <%end%>


                |

                  <% if @wishlist.nil? %>
                      <a style="color: #3A4A59;"  href="/wishlist/<%=item.id%>"  id="wish<%=item.id%>button" onclick="return theFunction(<%=item.id%>); " data-remote="true"><span id="wish<%=item.id%>icon" class="far fa-heart"></span></a>

                <%else%>
                  <% if @wishlist.include?(item.id.to_s) %>
                    <span class="fa fa-heart text-primary"></span>
                    <% else %>
                    <span id="wish<%=item.id%>button_off" style="display: none;" class="fa fa-heart text-primary"></span>
                    <a style="color: #3A4A59;"  href="/wishlist/<%=item.id%>"  id="wish<%=item.id%>button" onclick="return theFunction(<%=item.id%>); " data-remote="true"><span id="wish<%=item.id%>icon" class="far fa-heart"></span></a>
                  <%end%>
                <% end %>

              </div>

              </div>

              <div class="card-footer text-center">
                <small class="text-muted text-uppercase"><span style="color: #3A4A59;"> Цена :</span></small>
                <%if item.item_discount > 0 %>
                    <del class="op-5">&#8381; <%=item.item_price%></del>
                    /
                   <strong> <%=item.item_price - (item.item_price * item.item_discount / 100)%> &#8381;</strong>
                <%else %>
                   <strong> <%=item.item_price%> &#8381;</strong>
                <%end%>
               <br/>

                <small class="text-muted text-uppercase"><span style="color: #3A4A59;">  Оптовая цена :</span></small>
               <strong><%=item.item_opt_price%> &#8381; </strong>

                <a href="#" data-toggle="tooltip" title="" data-original-title="При заказе от :  <%=item.item_opt_price_count%> штук"><i style="color: #3A4A59;" class="fa fa-info-circle fa-lg "></i></a>
                <% if session[:admin]%>
                    <hr>
                    <a href="/admin/edititem?item_id=<%=item.id%>" class="btn btn-primary">Редактировать</a>
                <%end%>
              </div>
            </div>
          </div>
        <% end %>
        </div>

        <!-- Pagination -->
       <div class="digg_pagination">

          <%= will_paginate @items,:previous_label => t("<<"), :next_label => t(">>"), :container => false %>
        </div>
      </div>


      <!-- Products sidebar -->



  <hr class="my-5">
  <div class="container">
    <%=@subcat.subcat_description.html_safe %>

  </div>
</div>
<script language="JavaScript">
    $( document ).ready(function() {
        $('#<%=@parent_cat.cat_name_translit %>').addClass('show');
        $('#<%=@subcat.subcat_name_translit %>').addClass('text-primary');

    });
    function theFunction (id) {
        $("#cart_buttons_"+id).css('display','none');
        $("#spinner_"+id).addClass('spinner');
    return true;
    }

    function getSearchParams(k){
        var p={};
        location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(s,k,v){p[k]=v})
        return k?p[k]:p;
    }
    if (getSearchParams('sort_type')!== undefined){
        $('#sort_select').val(getSearchParams('sort_type')).attr("selected", "selected");
    }
    if (getSearchParams('search')!== undefined){
        $('#searchtxt').val(decodeURIComponent(getSearchParams('search')));
    }
    if (getSearchParams('pp')!== undefined){
        $('#pp_select').val(decodeURIComponent(getSearchParams('pp')));
    }
    if (getSearchParams('filter')!== undefined){
        $('#filter-'+decodeURIComponent(getSearchParams('filter'))).addClass('active');

    }


</script>